---
- name: 'Enable ports for RocketPool smart node'
  iptables:
    comment: 'RocketPool Smart Node ports'
    action: insert
    chain: DOCKER-USER
    jump: ACCEPT
    source: '0.0.0.0/0'
    protocol: '{{ rule.protocol }}'
    destination_port: '{{ rule.port }}'
  when: '{{rule.port != ""}}'
  with_items:
    - { protocol: 'tcp', port: '{{ "" if rocketpool_smart_node_web3_url == "" else rocketpool_smart_node_geth_listening_port }}' }
    - { protocol: 'tcp', port: '{{ rocketpool_smart_node_eth2_libp2p_port }}' }
    - { protocol: 'udp', port: '{{ rocketpool_smart_node_eth2_discovery_port }}' }
  loop_control:
    loop_var: rule
  notify:
    - Save iptables rules
